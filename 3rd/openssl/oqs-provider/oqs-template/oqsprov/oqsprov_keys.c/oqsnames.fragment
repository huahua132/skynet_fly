
{% set count = namespace(val=0) %}
{% set kemcount = namespace(val=0) %}

{% for kem in config['kems'] %}
{%- set kemcount.val = kemcount.val + 1 -%}
{% for hybrid in kem['hybrids'] %}
{%- set kemcount.val = kemcount.val + 1 -%}
{%- endfor -%}
{%- endfor -%}

{%- for sig in config['sigs'] %}
{%- for variant in sig['variants'] -%}
{%- set count.val = count.val + 1 -%}
{%- for classical_alg in variant['mix_with'] %}
{%- set count.val = count.val + 1 -%}
{%- endfor -%}
{%- for composite_alg in variant['composite'] %}
{%- set count.val = count.val + 1 -%}
{%- endfor -%}
{%- endfor -%}
{%- endfor %}

#ifdef OQS_KEM_ENCODERS
#define NID_TABLE_LEN {{ count.val + kemcount.val }}
#else
#define NID_TABLE_LEN {{ count.val }}
#endif

static oqs_nid_name_t nid_names[NID_TABLE_LEN] = {
#ifdef OQS_KEM_ENCODERS
{% for kem in config['kems'] %}
  { 0, "{{ kem['name_group'] }}", {{ kem['oqs_alg'] }}, KEY_TYPE_KEM, {{ kem['bit_security'] }} },
{%- for hybrid in kem['hybrids'] %}
  { 0, "{{hybrid['hybrid_group']}}_{{ kem['name_group'] }}", {{ kem['oqs_alg'] }}, {% if hybrid['hybrid_group'].startswith('p') -%} KEY_TYPE_ECP_HYB_KEM {% else %} KEY_TYPE_ECX_HYB_KEM {% endif %}, {{ kem['bit_security'] }} },
{%- endfor -%}
{%- endfor %}

#endif /* OQS_KEM_ENCODERS */

{%- for sig in config['sigs'] -%}
   {%- for variant in sig['variants'] %}
       { 0, "{{variant['name']}}", {{variant['oqs_meth']}}, KEY_TYPE_SIG, {{variant['security']}} },
     {%- for classical_alg in variant['mix_with'] %}
       { 0, "{{ classical_alg['name'] }}_{{variant['name']}}", {{variant['oqs_meth']}}, KEY_TYPE_HYB_SIG, {{variant['security']}} },
     {%- endfor %}
     {%- for composite_alg in variant['composite'] %}
       { 0, "{{variant['name']}}_{{ composite_alg['name'] }}", {{variant['oqs_meth']}}, KEY_TYPE_CMP_SIG, {{composite_alg['security']}} },
     {%- endfor %}
   {%- endfor %}
{%- endfor %}

